{% extends "layouts/base.njk" %}

{% block content %}
<section class="section">
    <div class="container">
        <div class="columns is-centered">
            <div class="column is-8-tablet is-6-desktop">
                <div class="box">
                    <h1 class="title has-text-centered">Add New Car</h1>

                    {% if flash.error %}
                        <div class="notification is-danger">
                            {{ flash.error }}
                        </div>
                    {% endif %}

                    <form action="/manage/cars/create" method="POST" enctype="multipart/form-data">
                        {% include "partials/csrf.njk" %}
                        <div class="field">
                            <label class="label">Brand</label>
                            <div class="control">
                                <input class="input" type="text" name="brand" required>
                            </div>
                        </div>

                        <div class="field">
                            <label class="label">Model</label>
                            <div class="control">
                                <input class="input" type="text" name="model" required>
                            </div>
                        </div>

                        <div class="field">
                            <label class="label">Year</label>
                            <div class="control">
                                <input class="input" type="number" name="year" min="1900" max="2025" required>
                            </div>
                        </div>

                        <div class="field">
                            <label class="label">Price per Day</label>
                            <div class="control has-icons-left">
                                <input class="input" type="number" name="pricePerDay" min="0" step="0.01" required>
                                <span class="icon is-small is-left">
                                    <i class="fas fa-dollar-sign"></i>
                                </span>
                            </div>
                        </div>

                        <div class="field">
                            <label class="label">Color</label>
                            <div class="control">
                                <input class="input" type="text" name="color" required>
                            </div>
                        </div>

                        <div class="field">
                            <label class="label">Mileage</label>
                            <div class="control">
                                <input class="input" type="number" name="mileage" min="0" required>
                            </div>
                        </div>

                        <div class="field">
                            <div class="control">
                                <label class="checkbox">
                                    <input type="checkbox" name="ac">
                                    Has Air Conditioning
                                </label>
                            </div>
                        </div>

                        <div class="field">
                            <label class="label">Transmission</label>
                            <div class="control">
                                <div class="select is-fullwidth">
                                    <select name="transmission" required>
                                        <option value="manual">Manual</option>
                                        <option value="automatic">Automatic</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="field">
                            <label class="label">Capacity</label>
                            <div class="control">
                                <input class="input" type="number" name="capacity" min="1" required>
                            </div>
                        </div>

                        <div class="field">
                            <label class="label">Image</label>
                            <div class="file has-name is-fullwidth">
                                <label class="file-label">
                                    <input class="file-input" type="file" name="image">
                                    <span class="file-cta">
                                        <span class="file-icon">
                                            <i class="fas fa-upload"></i>
                                        </span>
                                        <span class="file-label">
                                            Choose a fileâ€¦
                                        </span>
                                    </span>
                                    <span class="file-name">
                                        No file selected
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="field is-grouped is-grouped-centered">
                            <p class="control">
                                <button type="submit" class="button is-primary">
                                    <span class="icon">
                                        <i class="fas fa-save"></i>
                                    </span>
                                    <span>Create</span>
                                </button>
                            </p>
                            <p class="control">
                                <a href="/manage/cars" class="button is-light">
                                    <span class="icon">
                                        <i class="fas fa-times"></i>
                                    </span>
                                    <span>Cancel</span>
                                </a>
                            </p>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const fileInput = document.querySelector('input[type="file"][name="image"]');
    const fileName = document.querySelector('.file-name');
    
    if (fileInput && fileName) {

      fileInput.onchange = function() {
        if (this.files && this.files.length > 0) {
          console.log('Selected file:', this.files[0].name);
          fileName.textContent = this.files[0].name;
        } else {
          fileName.textContent = 'No file selected';
        }
      };
        document.addEventListener('click', function() {
        setTimeout(() => {
          if (fileInput.files.length === 0 && fileName.textContent !== 'No file selected') {
            fileName.textContent = 'No file selected';
          }
        }, 100);
      });
    } else {
      console.error('Could not find file elements:', { 
        fileInputFound: !!fileInput, 
        fileNameFound: !!fileName 
      });
    }
  });
</script>
{% endblock %}